{"version":3,"sources":["overwebs-app.js"],"names":["GluonElement","html","onRouteChange","resolveURL","_mobile","test","substr","navigator","userAgent","vendor","window","opera","document","documentElement","style","setProperty","playerStub","unlocks","ana","bastion","dva","genji","hanzo","junkrat","lucio","mccree","mei","mercy","pharah","reaper","reinhardt","roadhog","soldier76","symmetra","torbjorn","tracer","widowmaker","winston","zarya","zenyatta","sombra","OverwebsApp","template","constructor","firebase","initializeApp","apiKey","authDomain","databaseURL","_routes","history","replaceState","dispatchEvent","Event","connectedCallback","$","playerData","player","match","backgroundData","select","_oldPath","slice","classList","remove","loggedIn","add","console","warn","back","chat","setAttribute","removeAttribute","background","page","tagName","toLowerCase","modulesAssetPath","log","cookie","Array","prototype","map","call","pages","children","getAttribute","lowBandwidth","replace","_login","loginPage","addEventListener","detail","anonymous","userName","battleTag","backgrounds","_notification","_queue","queueType","Math","random","toString","length","auth","createUserWithEmailAndPassword","then","database","ref","uid","push","catch","code","signInWithEmailAndPassword","info","updateProfile","displayName","Promise","fetch","json","any","eu","us","kr","stats","quickplay","overall_stats","level","prestige","avatar","ceil","queue","notification","Polymer","dom","appendChild","customElements","define","is"],"mappings":"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","file":"overwebs-app.js","sourcesContent":["import { GluonElement, html } from '../gluonjs/gluon.js';\nimport { onRouteChange, resolveURL } from '../gluon-router/gluon-router.js';\nimport '../overwebs-main-page/overwebs-main-page.js';\nimport '../overwebs-login-page/overwebs-login-page.js';\nimport '../overwebs-play-page/overwebs-play-page.js';\nimport '../overwebs-background-data/overwebs-background-data.js';\nimport '../overwebs-background/overwebs-background.js';\n\n// Test for mobile agents\nlet _mobile;\n(function(a) {\n  _mobile =\n    /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(\n      a\n    ) ||\n    /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(\n      a.substr(0, 4)\n    );\n})(navigator.userAgent || navigator.vendor || window.opera);\n\nif (_mobile) {\n  document.documentElement.style.setProperty(`--overwebs-window-size`, `1660px`);\n}\n\nconst playerStub = {\n  unlocks: {\n    ana: 12,\n    bastion: 47,\n    dva: 24,\n    genji: 42,\n    hanzo: 36,\n    junkrat: 18,\n    lucio: 46,\n    mccree: 12,\n    mei: 25,\n    mercy: 2,\n    pharah: 17,\n    reaper: 39,\n    reinhardt: 10,\n    roadhog: 32,\n    soldier76: 33,\n    symmetra: 15,\n    torbjorn: 17,\n    tracer: 27,\n    widowmaker: 25,\n    winston: 46,\n    zarya: 18,\n    zenyatta: 51,\n    sombra: 37\n  }\n};\n\nclass OverwebsApp extends GluonElement {\n  get template() {\n    return html`\n    <style>\n      :host {\n        display: block;\n        position: relative;\n        background: black;\n        overflow: hidden;\n        min-height: 100vh;\n      }\n\n      #chat[hidden] {\n        display: none;\n      }\n\n      #pages > *:not(.visible) {\n        display: none;\n      }\n\n      #exit {\n        display: block;\n        position: relative;\n        height: 100vh;\n        width: 100vw;\n        background: black;\n      }\n    </style>\n    <overwebs-background-data id=\"backgroundData\"></overwebs-background-data>\n    <overwebs-background id=\"background\"></overwebs-background>\n\n    <div id=\"pages\">\n      <a href=\"/\" route=\"exit\" id=\"exit\"></a>\n      <overwebs-login-page id=\"loginPage\" route=\"login\"></overwebs-login-page>\n      <overwebs-main-page id=\"mainPage\" route=\"main\"></overwebs-main-page>\n      <overwebs-gallery-page route=\"hero-gallery\"></overwebs-gallery-page>\n      <overwebs-play-page route=\"play\"></overwebs-play-page>\n      <overwebs-competitive-page route=\"competitive\"></overwebs-competitive-page>\n      <overwebs-arcade-page route=\"arcade\"></overwebs-arcade-page>\n      <overwebs-training-page route=\"training\"></overwebs-training-page>\n      <overwebs-vs-ai-page route=\"vs-ai\"></overwebs-vs-ai-page>\n      <div class=\"loading\" route=\"loading\"></div>\n    </div>\n\n    <overwebs-notification id=\"notification\" spinner hidden>\n      <div slot=\"title\" id=\"notification-title\"></div>\n      <div slot=\"message\" id=\"notification-message\"></div>\n      <div slot=\"button\" id=\"notification-button\"></div>\n    </overwebs-notification>\n\n    <overwebs-queue-manager id='queue-manager'></overwebs-queue-manager>\n\n    <overwebs-player-data id=\"playerData\"></overwebs-player-data>\n    <overwebs-chat-widget id=\"chat\" tabindex=\"-1\" firebase=\"[[firebase]]\" player-data=\"[[playerData]]\"></overwebs-chat-widget>\n    `;\n  }\n  constructor() {\n    super();\n    // TODO: Remember the initial route so we can redirect there after the loading redirect\n\n    var config = {\n      apiKey: 'AIzaSyD-FCqLAtCYYCitKmErFWT2xEQyHk7fhBU',\n      authDomain: 'overwebs-86c53.firebaseapp.com',\n      databaseURL: 'https://overwebs-86c53.firebaseio.com'\n    };\n    firebase.initializeApp(config);\n\n    this._routes = {};\n\n    // At initial boot, redirect to loading screen\n    window.history.replaceState({}, null, '/loading');\n    window.dispatchEvent(new Event('location-changed'));\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.$.playerData.player = playerStub;\n\n    onRouteChange((path, query, hash) => {\n      // Some browsers call `onRouteChange` before `ready`.\n      // If this happens, `this._routes` is still empty.\n      // In that case, simply defer the call to `_routeChanged`.\n      // if (Object.keys(this._routes).length === 0) {\n      //   setTimeout(() => { this._routeChanged(newRoute, oldRoute) }, 0);\n      //   return;\n      // }\n\n      // I'm not sure if this belongs here. Maybe I need to extract the logic for this somehow and expose an API\n      const backgroundChange = query.match(/background=([^\\?]*)/);\n      if (backgroundChange) {\n        this.$.backgroundData.select = backgroundChange[1]; // TODO: USE QUERY\n        window.history.replaceState({}, null, '/main');\n        window.dispatchEvent(new Event('location-changed'));\n        return;\n      }\n\n      // Remove initial '/' in the route path\n      const oldPath = this._oldPath;\n      const newPath = path.slice(1);\n      this._oldPath = newPath;\n\n      // Hide the old page\n      if (this._routes[oldPath]) {\n        this._routes[oldPath].classList.remove('visible');\n      }\n\n      // Redirect to login if we are not logged in\n      if (!this.loggedIn && newPath != 'login') {\n        window.history.replaceState({}, null, '/login');\n        window.dispatchEvent(new Event('location-changed'));\n        return;\n      }\n\n      // Show the new page\n      if (this._routes[newPath]) {\n        this._routes[newPath].classList.add('visible');\n      } else {\n        // Go back if the new page does not exist (and the old page does)\n        if (this._routes[oldPath]) {\n          console.warn('Requested page does not exist');\n          window.history.back();\n        }\n        return;\n      }\n\n      // Enable or disable or move the chat widget depending on the page.\n      // Should this be responsibility of the app? I don't know.\n      if (newPath === 'login') {\n        this.$.chat.setAttribute('hidden', '');\n      } else {\n        this.$.chat.removeAttribute('hidden');\n      }\n\n      // Notify the background element that we changed route\n      this.$.background.page = newPath;\n\n      // Lazy load any new pages we are visiting that haven't been loaded yet\n      if (newPath != 'main' && this._routes[newPath] && newPath != 'exit') {\n        let newPathElement = this._routes[newPath].tagName.toLowerCase();\n        // TODO: Relative imports\n        let newPage = (window.modulesAssetPath && `${window.modulesAssetPath(newPathElement)}/${newPathElement}.js`) || 'someElement.js';\n        console.log(`Attempting to lazy-load ${newPage}`);\n        // TODO: Dynamic imports\n        // import(newPage).then(() => {\n        //   console.log('Lazy loaded ' + newPage);\n        // }, () => {\n        //   console.warn('Cannot lazy load ' + newPage);\n        //   window.history.back();\n        // });\n      }\n\n      if (newPath === 'exit') {\n        document.cookie = 'userName=;expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n        document.cookie = 'battleTag=;expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n        document.cookie = 'anonymous=;expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n        this.loggedIn = false;\n      }\n    });\n\n    Array.prototype.map.call(this.$.pages.children, page => {\n      this._routes[page.getAttribute('route')] = page;\n    });\n    if (_mobile) {\n      this.$.background.lowBandwidth = true;\n    }\n\n    // Check if this user has previously logged in by checking cookies\n    const anonymous = document.cookie.replace(/(?:(?:^|.*;\\s*)anonymous\\s*\\=\\s*([^;]*).*$)|^.*$/, '$1');\n    if (anonymous) {\n      // If the user logged in as anonymous, perform anonymous login\n      this._login(null, null, anonymous);\n    } else {\n      const userName = document.cookie.replace(/(?:(?:^|.*;\\s*)userName\\s*\\=\\s*([^;]*).*$)|^.*$/, '$1');\n      // If the user logged in with a userName, perform login with userName and battleTag\n      if (userName) {\n        const battleTag = document.cookie.replace(/(?:(?:^|.*;\\s*)battleTag\\s*\\=\\s*([^;]*).*$)|^.*$/, '$1');\n        this._login(userName, battleTag, false);\n      } else {\n        // Otherwise, redirect to login page\n        window.history.replaceState({}, null, '/login');\n        window.dispatchEvent(new Event('location-changed'));\n      }\n    }\n\n    // Listen to login events from the loginPage\n    this.$.loginPage.addEventListener(\n      'login',\n      e => {\n        const login = e.detail;\n        if (login.anonymous) {\n          document.cookie = `anonymous=true`;\n        } else {\n          document.cookie = `userName=${login.userName}`;\n          if (login.battleTag) {\n            document.cookie = `battleTag=${login.battleTag}`;\n          }\n        }\n        this._login(login.userName, login.battleTag, login.anonymous);\n      },\n      true\n    );\n\n    this.$.background.backgrounds = this.$.backgroundData.backgrounds;\n    this.$.backgroundData.addEventListener('backgrounds-changed', () => (this.$.background.backgrounds = this.$.backgroundData.backgrounds), true);\n\n    this.addEventListener('notification', e => this._notification(e), true);\n\n    this.addEventListener('queue', e => this._queue(e.detail.queueType), true);\n  }\n\n  _login(userName, battleTag, anonymous) {\n    let userID;\n\n    if (anonymous) {\n      let anonymousTag = document.cookie.replace(/(?:(?:^|.*;\\s*)anonymousTag\\s*\\=\\s*([^;]*).*$)|^.*$/, '$1');\n      // Generate a persistent random tag for Anonymous logins\n      if (!anonymousTag) {\n        anonymousTag = Math.random()\n          .toString(36)\n          .slice(2, 8);\n        document.cookie = `anonymousTag=${anonymousTag}`;\n      }\n      userID = `Anonymous-${anonymousTag}`;\n    } else if (battleTag) {\n      userID = `${userName}-${battleTag}`;\n    } else {\n      userID = userName;\n    }\n\n    // Create a password equal to userID padded with 0s\n    const password = userID + '000000'.slice(userID.length);\n\n    // Log the user into firebase\n    firebase\n      .auth()\n      .createUserWithEmailAndPassword(`${userID}@ruph.in`, password)\n      .then(e => {\n        // If a new user is created, push the userID\n        // onto the database message list so we know who's who\n        firebase\n          .database()\n          .ref(`messages/${e.uid}`)\n          .push(userID);\n        return e;\n      })\n      .catch(e => {\n        // If the user already logged in before, just log in directly\n        if (e.code == 'auth/email-already-in-use') {\n          return firebase.auth().signInWithEmailAndPassword(`${userID}@ruph.in`, password);\n        }\n      })\n      .then(e => {\n        console.info(`Logged in as ${userID}`);\n        e.updateProfile({ displayName: userID.replace('-', '#') }).catch(e => {\n          console.warn('Failed to add DisplayName');\n        });\n      })\n      .catch(e => {\n        console.warn('Firebase login failed');\n        console.warn(e);\n      });\n\n    // Set correct level and avatar for provided user\n    new Promise((resolve, reject) => {\n      // If the user is not anonymous and has a battleTag, we look up their stats.\n      if (!anonymous && battleTag) {\n        resolve();\n      } else {\n        // Otherwise fall back to random\n        reject();\n      }\n    })\n      .then(() => fetch(`https://owapi.net/api/v3/u/${userName}-${battleTag}/stats`))\n      .then(response => response.json())\n      .then(json => {\n        const account = json.any || json.eu || json.us || json.kr;\n        const stats = account.stats.quickplay.overall_stats;\n        this.$.playerData.level = stats.prestige * 100 + stats.level;\n        this.$.playerData.avatar = stats.avatar;\n      })\n      .catch(e => {\n        // If anything fails, use a random level and avatar\n        this.$.playerData.level = Math.ceil(Math.random() * 400);\n        // TODO: Random avatar\n      });\n\n    this.loggedIn = true;\n    window.history.replaceState({}, null, '/main');\n    window.dispatchEvent(new Event('location-changed'));\n  }\n\n  _queue(queueType) {\n    console.log(this.$['queue-manager']);\n    this.$['queue-manager'].queue(queueType);\n  }\n\n  _notification(e) {\n    this.$.notification.removeAttribute('hidden');\n    if (e.detail['title']) {\n      Polymer.dom(this.$['notification-title']).appendChild(e.detail['title']);\n    }\n    if (e.detail['message']) {\n      Polymer.dom(this.$['notification-message']).appendChild(e.detail['message']);\n    }\n    if (e.detail['button']) {\n      Polymer.dom(this.$['notification-button']).appendChild(e.detail['button']);\n    }\n  }\n}\n\ncustomElements.define(OverwebsApp.is, OverwebsApp);\n"]}